<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Page Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    html, body {
      width:  100%;
      height: 100%;
      margin: 0px;
      overflow: hidden; /*  Disable scrollbars */
      display: block;  /* No floating content on sides */
    }
    body {
      background: url('./galaxy.jpg');
    }
  </style>
</head>
<body>
  <script>
    var spaceship = new Image();
    spaceship.src = "./spaceship.png";
    var rocket =  new Image();
    rocket.src = "./rocket.png";

    var playing = true;
    var rockets = {};

    var counter = 0;

    class World {
      constructor(){
        this.w = window.innerWidth;
        this.h = window.innerHeight; 
      }
    }

    class Rocket {
      constructor(x,y,n){
        this.x = x;
        this.y = y - 11 / 2;
        this.w = 60;
        this.h = 11;
        this.velocity = 6;
        this.number = n;
      }

      draw(ctx){
         if ((this.x + this.w) < world.w) {
          ctx.drawImage(rocket, this.x, this.y, this.w, this.h);
          this.x += this.velocity;
        }
        else {
          var explode = new Audio('audio/explosion.wav');
          explode.play();
          delete rockets[this.number];
        }
      }
    }

    class Player {
      constructor() {
        this.h = 100;
        this.w = 100;
        this.x = world.w / 2 - 50;
        this.y = world.h / 2 - 50;
        this.velocity = 10;
      }

      move(direction, ctx) {
        // console.log('moving');
        if (direction === 'left') {
          this.x = Math.max(this.x - this.velocity, 0);
        }
        if(direction === 'up'){
          this.y = Math.max(this.y - this.velocity, 0);
        }
        
        if (direction === 'right') {
          this.x = Math.min(this.x + this.velocity, world.w - this.w);
        }
        if (direction === 'down') {
          this.y = Math.min(this.y + this.velocity, world.h - this.h);
        }
      }
    }

    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext("2d");
    var world = new World();
    var player = new Player();

    canvas.id = 'canvas';
    canvas.width = world.w;
    canvas.height = world.h;

    spaceship.onload = function () {
      main();
    }

     document.body.appendChild(canvas);

    function main(){
      document.addEventListener("keydown", function (e) {
        // console.log('keydown');

        if (e.keyCode === 37) {
          player.move('left', ctx);
        }
        if (e.keyCode === 38) {
          player.move('up', ctx);
        }
        if (e.keyCode === 39) {
          player.move('right', ctx);
        }
        if (e.keyCode === 40) {
          player.move('down', ctx);
        }

        if (e.keyCode === 32) {
          let rocket = new Rocket(player.x + player.w / 2, player.y + player.h / 2, counter);
          rockets[counter++] = rocket;
        }
      });

      var loop = function () {
        draw();
        
        if (playing) {
          window.requestAnimationFrame(loop, canvas);
        }
      };
      window.requestAnimationFrame(loop, canvas);
    }

    
    function draw() {
      ctx.clearRect(0, 0, world.w, world.h);

      ctx.drawImage(spaceship, player.x, player.y, player.w, player.h);
      
      if (Object.keys(rockets).length) {
        for (var i in rockets) {
          rockets[i].draw(ctx);
        }
      }
      
      ctx.save();
      ctx.restore();
      
    }





    
      
   

    

    // Version 1
    // function stopGame() {
    //   clearInterval(game);
    // }

    // function play() {
    //   while (playing) {
    //     console.log('player x ', player.x);
    //     console.log('screen world.w ', world.w);
    //     console.log('   ');
    //     console.log('   ');

    //     if (player.x + player.w < world.w ) {
    //       ctx.fillStyle = "#000";
    //       ctx.fillRect(player.x, player.y, player.w, player.h);
    //       ctx.save();

    //       player.x += player.speed;
    //     }
    //     else if (
    //       player.x + player.w > world.w && 
    //       player.y + player.h < world.h
    //     ) {
    //       player.x = 0;
    //       player.y += player.jump;
    //     }
    //     else {
    //       playing = false;
    //     }
    //   }
    // }
    // play();
    
    // Version 2
    // var game = setInterval(function () { play() }, 500);

    // function play() {
    //   if (player.x + player.w < world.w) {
    //     ctx.clearRect(0, 0, world.w, world.h);
    //     ctx.fillStyle = "#000";
    //     ctx.fillRect(player.x, player.y, player.w, player.h);
    //     ctx.save();

    //     player.x += player.speed;
    //   }
    //   else if (
    //     player.x + player.w > world.w && 
    //     player.y + player.h < world.h
    //   ) {
    //     player.x = 0;
    //     player.y += player.jump;
    //   }
    //   else {
    //     stopGame();
    //   }
    // }

  </script>
</body>
</html>